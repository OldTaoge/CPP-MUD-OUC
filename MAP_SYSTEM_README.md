# 地图系统设计文档

## 概述

本项目实现了一个基于区块的地图系统，包含5个不同的游戏区块，每个区块都有独特的交互内容和游戏机制。

## 地图区块设计

### 区块1: 新手教学区 (0, 0)
- **类型**: 教学区块
- **功能**: 教会用户移动、拾取物品等基本操作
- **交互**:
  - 拾取物品: 获得苹果，学习拾取机制
  - 激活: 学习移动控制
- **完成条件**: 成功拾取物品

### 区块2: 七天神像（风）(2, 0)
- **类型**: 七天神像区块
- **功能**: 给予旅行者风元素、打开宝箱并获得奖励
- **交互**:
  - 激活: 激活七天神像，获得风元素能力
  - 拾取: 打开宝箱，获得风鹰剑、翠绿之影、风之印
- **完成条件**: 激活神像并打开宝箱

### 区块3: 史莱姆栖息地 (1, 1)
- **类型**: 战斗区块
- **功能**: 史莱姆战斗体验并产生掉落物
- **交互**:
  - 战斗: 与史莱姆战斗，获得经验和掉落物
- **奖励**: 史莱姆凝液、史莱姆原浆、50经验
- **完成条件**: 击败史莱姆

### 区块4: 安伯的营地 (0, 2)
- **类型**: 对话区块
- **功能**: 遇到安伯，对话并加入队伍
- **交互**:
  - 对话: 与安伯对话，了解背景故事
- **奖励**: 安伯加入队伍（20级弓箭手）
- **完成条件**: 安伯加入队伍

### 区块5: 蒙德城 (2, 2)
- **类型**: 城市区块
- **功能**: 到达蒙德城，遇到凯亚并加入队伍
- **交互**:
  - 进入: 进入蒙德城
  - 对话: 与凯亚对话
- **奖励**: 凯亚加入队伍（25级冰元素剑士）
- **完成条件**: 凯亚加入队伍

## 技术架构

### 核心类

#### MapBlock (基类)
- 所有地图区块的基类
- 定义基本的交互接口
- 管理区块状态（锁定/解锁/完成）

#### MapManager
- 管理整个地图系统
- 处理玩家移动和位置
- 协调区块间的交互
- 提供地图渲染功能

#### 具体区块类
- `TutorialBlock`: 教学区块
- `StatueOfSevenBlock`: 七天神像区块
- `SlimeBattleBlock`: 史莱姆战斗区块
- `AmberDialogueBlock`: 安伯对话区块
- `MondstadtCityBlock`: 蒙德城区块

### 交互系统

#### InteractionType 枚举
- `PICKUP`: 拾取物品
- `BATTLE`: 战斗
- `DIALOGUE`: 对话
- `ACTIVATE`: 激活
- `ENTER`: 进入

#### InteractionResult 结构
- `success`: 交互是否成功
- `message`: 交互结果消息
- `rewards`: 获得的物品奖励
- `blockCompleted`: 区块是否完成

## 使用方法

### 基本操作
- **移动**: 使用 W/A/S/D 或方向键移动角色
- **交互**: 按空格键与当前区块交互
- **工具菜单**: 按 T 键打开工具菜单

### 地图界面
- 显示当前地图状态
- 显示玩家位置和区块信息
- 提供交互选项菜单

### 游戏流程
1. 从新手教学区开始
2. 学习基本操作（移动、拾取）
3. 前往七天神像获得风元素能力
4. 在史莱姆栖息地进行战斗训练
5. 与安伯对话并加入队伍
6. 前往蒙德城与凯亚对话

## 扩展性

### 添加新区块
1. 继承 `MapBlock` 基类
2. 实现 `initializeInteractionHandlers()` 方法
3. 定义具体的交互处理函数
4. 在 `MapManager::initializeMap()` 中添加新区块

### 添加新交互类型
1. 在 `InteractionType` 枚举中添加新类型
2. 在相关区块中实现对应的处理函数
3. 更新UI界面以支持新的交互类型

## 文件结构

```
src/core/
├── map.h          # 地图系统头文件
├── map.cpp        # 地图系统实现
├── game.h         # 游戏类（已更新）
└── game.cpp       # 游戏类实现（已更新）

src/display/screens/
├── map.hpp        # 地图界面头文件
├── map.cpp        # 地图界面实现
├── gameplay.hpp   # 游戏界面头文件（已更新）
└── gameplay.cpp   # 游戏界面实现（已更新）

test_map.cpp       # 地图系统测试程序
```

## 编译和运行

1. 确保所有文件都已添加到 CMakeLists.txt
2. 编译项目: `cmake --build build`
3. 运行测试: `./build/test_map` (如果创建了测试程序)
4. 运行游戏: `./build/CPP_MUD_OUC`

## 注意事项

- 地图坐标系统: (0,0) 为左上角，X轴向右，Y轴向下
- 玩家位置会自动与地图管理器同步
- 区块状态会影响可用的交互选项
- 所有交互都有相应的反馈消息和奖励机制
